<html>
<head>
    <link rel="stylesheet" href="http://code.jquery.com/ui/1.8.20/themes/base/jquery-ui.css" type="text/css" media="all" />
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
    <script src="http://code.jquery.com/ui/1.8.20/jquery-ui.min.js" type="text/javascript"></script>
    <script src="swappable.js" type="text/javascript"></script>
    <script src="hotkeys.js" type="text/javascript"></script>
	<style>
		body { font-size: 62.5%; }
		label, input { display:block; }
		input.text { margin-bottom:12px; width:95%; padding: .4em; }
		fieldset { padding:0; border: 1px solid #eee; margin-top:10px; margin-right: 0px; margin-left: 0px; margin-bottom: 0px;}
		h1 { font-size: 1.2em; margin: .6em 0; }
		div#users-contain { width: 350px; margin: 20px 0; }
		div#users-contain table { margin: 1em 0; border-collapse: collapse; width: 100%; }
		div#users-contain table td, div#users-contain table th { border: 1px solid #eee; padding: .6em 10px; text-align: left; }
        .inventoryList { list-style-type: none; margin: 0; padding: 0; }
        .inventoryItem { margin: 3px 3px 3px 0; padding: 1px; float: left; width: 250px; font-size: 3em; }
        .inventoryItem a { text-decoration: none; }
        .inventoryItem a:visited { text-decoration: none; }
        .inventoryItem a:focus { outline: none; }
        .inventoryItem fieldset { padding:0; border: 1px solid #eee; margin-top:10px; margin-right: 0px; margin-left: 0px; margin-bottom: 0px;}
        .inventoryItem .icon { }
        .inventoryItem .letter { height: 48px; width: 48px; vertical-align: 13px; margin-left: 20px; }
        .inventoryItem .desc { vertical-align: 13px; }
		.ui-dialog .ui-state-error { padding: .3em; }
		.validateTips { border: 1px solid transparent; padding: 0.3em; }
	</style>
	<script>
	$(function() {

    
        (function( $ ){

            var methods = {
                init : function( options ) {
                
                    var s = $.extend( {
                        'modal' : true,
                        'resizable' : true,
                        'maxItems' : 52, // total number of unique items allowed in inventory
                        'maxPerPage' : 20, // max items per page; also sets window height for scrolled
                        'cols' : 1, // columns in the list
                        'emptyText' : 'Inventory is empty!', // for when the inventory has no items
                        'itemClass' : 'inventoryItem', // css class for each item
                        'listClass' : 'inventoryList', // css class for the containing list
                        'paged' : false, // either paged if false (like ADOM) or scrolled if true (like Crawl webtiles)
                        'categories' : false, // either flat or organized by item.category
                        'lettered' : true, // items in the inventory will have letters + binding
                        buttons: {
                            cancel: function() {
                                $( this ).dialog( "close" );
                            }
                        }
                    }, options);
                    
                    // XXX: add next/prev for paged
                    //      grab next/prev after dialog creation and then style them
                    
                    if ((!s.paged) && (s.maxItems > 62)) {
                        throw("use a paged inventory if the total maxItems will be greater than 62!");
                    }
                    
                    return this.each(function(){
                 
                        var $this = $(this);
                        var data = $this.data('inventory');
                                                
                        // If the plugin hasn't been initialized yet
                        if ( ! data ) {
                        
                            var ul = $this.inventory("makeList", s.listClass);
                            $this.append(ul);
                            
                            var dummy = $this.inventory("makeItem", s.itemClass, s.emptyText, ' ', undefined, 0);
                            ul.append(dummy);
                            var singleWidth = dummy.innerWidth();
                            s = $.extend({
                                'maxWidth' : s.cols * singleWidth,
                                'elementWidth' : dummy.width(),
                                'elementHeight' : dummy.outerHeight(),
                            }, s);
                            
                            dialog = $this.dialog({
                                autoOpen: false,
                                height: 'auto',
                                width: s.maxWidth,
                                resizeable: s.resizable,
                                modal: s.modal,
                                buttons: s.buttons,
                                close: function(event, ui) {
                                    var data = $this.data('inventory');
                                    data.ul.remove();
                                    data.ul = $(' <ul class="' + data.listClass + '">' );
                                    $this.append(data.ul);
                                    $this.unbind("keypress");
                                }
                            });
                            $this.dialog('option', 'width', singleWidth + $this.outerWidth()/2);
                            dummy.detach();
                        
                            $(this).data('inventory', {
                                dummy : dummy,
                                target : $this,
                                ul : ul,
                                cols : s.cols,
                                elementHeight: s.elementHeight,
                                elementWidth: s.elementWidth,
                                dialog : dialog,
                                maxPerPage : s.maxPerPage,
                                maxItems : s.maxItems,
                                listClass : s.listClass,
                                itemClass : s.itemClass,
                                categoryClass : s.categoryClass,
                                categoryWidthSet : false,
                                paged : s.paged,
                                categories : s.categories,
                                sorted : s.sorted,
                                letterMemory : s.letterMemory
                            });
                        }
                    })
                },
                
                makeItem : function(itemClass, text, letter, icon, id) {
                
                    var $this = $(this);
                    var li = $('<li class="' + itemClass + '"></li>');
                    var button = $('<a id="inventoryButton' + id + '" href="#1"></a>');
                    li.append(button);
                    
                    if (icon) {
                        var iconSpan = $('<span class="icon"><img src="' + icon + '" /></span>');
                        button.append(iconSpan);
                    }
                    
                    if (letter) {
                        var letterSpan =  $('<span class="letter">' + letter + '</span>');
                        letterSpan.swappable({
                            accept: '.letter',
                            callback : function(dropTarget,draggedItem) {
                                alert(dropTarget.text() + ' ' + draggedItem.text());
                            }
                        });
                        button.append(letterSpan);
                    }
                    
                    if (letter && text) {
                        button.append($('<span class="desc"> - </span>'));
                    }
                    
                    if (text) {
                        var textSpan = $('<span class="desc">' + text + '</span>');
                        button.append(textSpan);
                    }
                    
                    selecter = function() {
                        alert(id);
                        $this.dialog("close");
                    };
                
                    button.click(selecter);
                    $this.bind('keypress', letter, selecter);
                
                    return li;
                },
                
                displayCategoryList : function(sortedLetters, letterLookup) {
                
                    var $this = $(this);
                    var data = $this.data('inventory');
                
                    var categories = new Object();
                    var categoryNames = new Array();
                    var fieldsets = new Object();
                    var subUL = new Object();
                    
                    for(var i=0; i<sortedLetters.length; i++) {
                        var item = letterLookup[sortedLetters[i]];
                        var cat = item.category;
                    
                        if (!(categories.hasOwnProperty(cat))) {
                            categoryNames.push(cat);
                            categories[cat] = 0;
                            
                            fieldsets[cat] = $('<fieldset></fieldset>');
                            fieldsets[cat].append($('<legend>' + item.category + '</legend>'));
                            subUL[cat] = $('<ul style="border: 0px; margin: 0px; padding: 0px;"></ul>');
                            subUL[cat].css('width', data.elementWidth + 'px');
                            fieldsets[cat].append(subUL[cat]);
                        }
                        
                        var li = $this.inventory('makeItem', data.itemClass, item.text, item.letter, item.icon, item.id);
                        categories[cat] ++;
                        subUL[cat].append(li);
                    }
                    
                    for (var i=0; i<categoryNames.length; i++) {
                        cat = categoryNames[i];
                        alert(cat + categories[cat]);
                    }
            
                    for (var i=0; i<categoryNames.length; i++) {
                        var li = $('<li style="border: 0px; margin: 0px; padding: 0px;"></li>');
                        var fs = fieldsets[categoryNames[i]];
                        li.append(fs);
                        
                        data.ul.append(li);
                        
                        if (!data.categoryWidthSet) {
                            var extraWidthB = parseInt(fs.css('border-left-width'), 10)
                                              + parseInt(fs.css('border-right-width'), 10);
                            var extraWidthP = parseInt(fs.css('margin-left'), 10)
                                              + parseInt(fs.css('margin-right'), 10);
                            var extraWidthM = parseInt(fs.css('padding-left'), 10)
                                              + parseInt(fs.css('padding-right'), 10);
                            var extraWidth = extraWidthB + extraWidthP + extraWidthM;
                            
                            var newWidth = $this.dialog('option', 'width') + extraWidth;
                            $this.dialog('option', 'width', newWidth);
                            data.categoryWidthSet = true;
                        }
                    }
                },
                
                displayFlatList : function(sortedLetters, letterLookup) {
                    for (var i=0; i<sortedLetters.length; i++) {
                        var item = letterLookup[sortedLetters[i]];
                        
                        var li = $this.inventory('makeItem', data.itemClass, item.text, item.letter, item.icon, item.id);
                        data.ul.append(li);
                    }
                },
                
                makeList : function(listClass) {
                    return $(' <ul class="' + listClass + '">' );
                },
                
                // close dialog
                close : function() {
                    return this.each(function(){
                        $this.dialog( "close" );
                    })
                },
             
                // add items to list and open dialog
                open : function(itemlist, offset) {
                
                    return this.each(function(){
                    
                        var $this = $(this);
                        var data = $this.data('inventory');
                        
                        // XXX: resize width if length of itemlist < cols
                        
                        if (itemlist.length == 0) {
                            data.ul.append(data.dummy);
                        }
                        else {
                        
                            var letters = new Array();
                            var letterLookup = new Object();
                            for(var i=0; i<itemlist.length; i++) {
                                letters.push(itemlist[i].letter);
                                letterLookup[itemlist[i].letter] = itemlist[i];
                            }

                            var sortedLetters = letters.sort();
                            
                            if (data.categories) {
                                $this.inventory('displayCategoryList', sortedLetters, letterLookup);
                            }
                            else {
                                $this.inventory('displayFlatList', sortedLetters, letterLookup);
                            }
                            
                            if (itemlist.length > data.maxPerPage) {
                                $this.dialog('option', 'height', (data.maxPerPage/data.cols)*data.elementHeight);
                            }
                            
                        }
                        
                        $this.dialog( "open" );
                    })
                },
                
                destroy : function( ) {
                    return this.each(function(){
                        var $this = $(this),
                            data = $this.data('inventory');

                        // Namespacing FTW
                        $(window).unbind('.inventory');
                        data.inventory.remove();
                        $this.removeData('inventory');
                    })
                }
            };

            $.fn.inventory = function( method ) {

                if ( methods[method] ) {
                    return methods[method].apply( this, Array.prototype.slice.call( arguments, 1 ));
                }
                else if ( typeof method === 'object' || ! method ) {
                    return methods.init.apply( this, arguments );
                }
                else {
                    $.error( 'Method ' +  method + ' does not exist on jQuery.inventory' );
                }    

            };

        })( jQuery );
		
	
		
		$( "#dialog-form" ).inventory({
            'modal' : true,
            'maxItems' : 52, // total number of unique items allowed in inventory
            'maxPerPage' : 5, // max items per page; also sets window height for scrolled
            'cols' : 1, // columns in the list
            'emptyText' : 'Inventory is empty!', // for when the inventory has no items
            'itemClass' : 'inventoryItem', // css class for each item
            'categoryClass' : 'inventoryCat', // css class for each sub-category; ignored if category:false
            'listClass' : 'inventoryList', // css class for the containing list
            'paged' : false, // either paged if false (like ADOM) or scrolled if true (like Crawl webtiles)
            'categories' : true, // either flat or organized by item.category
            'sorted' : false, // sorted will sort by item for paged, by letter for scrolled; and by category for either 
            'letterMemory' : true // new items will try to be assigned to the letter they were previously for scrolled
		});

		$( "#create-user" )
			.button()
			.click(function() {
				$( "#dialog-form" ).inventory( "open", [
                    {
                        'id' : 1,
                        'text' : 'one',
                        'letter' : 'a',
                        'icon' : 'rss_icon.png',
                        'category' : 'pig'
                    },
                    {
                        'id' : 2,
                        'text' : 'two',
                        'letter' : 'b',
                        'icon' : 'rss_icon.png',
                        'category' : 'cat'
                    },
                    {
                        'id' : 3,
                        'text' : 'three',
                        'letter' : 'c',
                        'icon' : 'rss_icon.png',
                        'category' : 'pig'
                    },
                    {
                        'id' : 4,
                        'text' : 'four',
                        'letter' : 'd',
                        'icon' : 'rss_icon.png',
                        'category' : 'pig'
                    },
                    {
                        'id' : 5,
                        'text' : 'five',
                        'letter' : 'e',
                        'icon' : 'rss_icon.png',
                        'category' : 'pig'
                    },
                    {
                        'id' : 6,
                        'text' : 'six',
                        'letter' : 'f',
                        'icon' : 'rss_icon.png',
                        'category' : 'cat'
                    },
                    {
                        'id' : 7,
                        'text' : 'seven',
                        'letter' : 'g',
                        'icon' : 'rss_icon.png',
                        'category' : 'pig'
                    },
                    {
                        'id' : 8,
                        'text' : 'eight',
                        'letter' : 'h',
                        'icon' : 'rss_icon.png',
                        'category' : 'dog'
                    },
                    {
                        'id' : 9,
                        'text' : 'nine',
                        'letter' : 'i',
                        'icon' : 'rss_icon.png',
                        'category' : 'pig'
                    }
                ], 0);
			});
	});
	</script>


</head>
<body>

    <div class="demo">

    <div id="dialog-form" title="Create new user">
        
    </div>


    <div id="users-contain" class="ui-widget">
        <h1>Existing Users:</h1>
        <table id="users" class="ui-widget ui-widget-content">
            <thead>
                <tr class="ui-widget-header ">
                    <th>Name</th>
                    <th>Email</th>
                    <th>Password</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>John Doe</td>
                    <td>john.doe@example.com</td>
                    <td>johndoe1</td>
                </tr>
            </tbody>
        </table>
    </div>
    <button id="create-user">Create new user</button>

    </div><!-- End demo -->



    <div class="demo-description">
    <p>Use a modal dialog to require that the user enter data during a multi-step process.  Embed form markup in the content area, set the <code>modal</code> option to true, and specify primary and secondary user actions with the <code>buttons</code> option.</p>
    </div><!-- End demo-description -->
</body>
</html>